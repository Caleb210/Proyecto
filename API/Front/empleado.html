<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <title>Empleados</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="container">
        <header>
            <ul class="nav nav-tabs" id="navId" role="tablist">
                <li class="nav-item">
                    <a href="index.html" class="nav-link active" role="button">Inicio</a>
                </li>
                <li class="nav-item">
                    <a href="#tab1Id" class="nav-link active" data-bs-toggle="tab">Empleados</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">Módulos</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="usuario.html">Usuarios</a>
                        <a class="dropdown-item" href="cliente.html">Clientes</a>
                        <a class="dropdown-item" href="categoriasmenu.html">Categorías Menú</a>
                        <a class="dropdown-item" href="platillos.html">Platillos</a>
                        <a class="dropdown-item" href="ingredientes.html">Ingredientes</a>
                        <a class="dropdown-item" href="pedido.html">Pedidos</a>
                        <a class="dropdown-item" href="detalles_pedido.html">Detalles Pedidos</a>
                        <a class="dropdown-item" href="mesas.html">Mesas</a>
                        <a class="dropdown-item" href="reserva.html">Reservas</a>
                        <a class="dropdown-item" href="proveedor.html">Proveedores</a>
                        <a class="dropdown-item" href="venta.html">Ventas</a>
                    </div>
                </li>
            </ul>
        </header>

        <h1>Empleados</h1>

        <div class="mb-3">
            <label for="nombre" class="form-label">Nombre</label>
            <input type="text" class="form-control" id="nombre" />
        </div>
        <div class="mb-3">
            <label for="puesto" class="form-label">Puesto</label>
            <select class="form-select" id="puesto">
                <option value="administrador">Administrador</option>
                <option value="mesero">Mesero</option>
                <option value="cocinero">Cocinero</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="salario" class="form-label">Salario</label>
            <input type="number" class="form-control" id="salario" />
        </div>
        <div class="mb-3">
            <label for="fecha_contratacion" class="form-label">Fecha De Contratacion</label>
            <input type="date" class="form-control" id="fecha_contratacion" />
        </div>
        <div class="mb-3">
            <label for="activo" class="form-label">Activo</label>
            <select class="form-select" id="activo">
                <option value="true">Si</option>
                <option value="false">No</option>
            </select>
        </div>

        <div class="mb-3">
            <a id="guardardatos" class="btn btn-primary" role="button">Guardar</a>
            <a id="actualizardatos" class="btn btn-success" style="display: none;" role="button">Actualizar</a>
            <input onclick="limpiarFormulario()" class="btn btn-danger" type="button" value="Limpiar" />
        </div>

        <div class="table-responsive">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Puesto</th>
                        <th>Salario</th>
                        <th>Fecha De Contratacion</th>
                        <th>Activo</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="listadatos"></tbody>
            </table>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            const API_URL = 'http://localhost:3000/api/empleado'; // Asegúrate que coincida con tu ruta en app.js

            // Función para limpiar el formulario
            function limpiarFormulario() {
                $('#nombre').val('');
                $('#puesto').val('mesero');
                $('#salario').val('');
                $('#fecha_contratacion').val('');
                $('#activo').val('true');
                $('#guardardatos').show();
                $('#actualizardatos').hide().data('id', '');
            }

            window.limpiarFormulario = limpiarFormulario;

            // Listar empleados
            function listarEmpleados() {
                $.get(API_URL, function (data) {
                    let filas = '';
                    data.forEach(empleado => {
                        filas += `
                    <tr>
                        <td>${empleado.nombre}</td>
                        <td>${empleado.puesto}</td>
                        <td>${empleado.salario}</td>
                        <td>${empleado.fecha_contratacion ? new Date(empleado.fecha_contratacion).toISOString().split('T')[0] : ''}</td>
                        <td>${empleado.activo ? 'Si' : 'No'}</td>
                        <td>
                            <button class="btn btn-sm btn-warning editar" data-id="${empleado._id}">Editar</button>
                            <button class="btn btn-sm btn-danger eliminar" data-id="${empleado._id}">Eliminar</button>
                        </td>
                    </tr>
                `;
                    });
                    $('#listadatos').html(filas);
                });
            }

            listarEmpleados();

            // Guardar nuevo empleado
            $('#guardardatos').click(function () {
                const empleado = {
                    nombre: $('#nombre').val(),
                    puesto: $('#puesto').val(),
                    salario: parseFloat($('#salario').val()),
                    fecha_contratacion: $('#fecha_contratacion').val(),
                    activo: $('#activo').val() === 'true'
                };

                $.ajax({
                    url: API_URL,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(empleado),
                    success: function () {
                        limpiarFormulario();
                        listarEmpleados();
                    },
                    error: function (err) {
                        alert('Error al guardar empleado: ' + err.responseJSON.message);
                    }
                });
            });

            // Editar empleado
            $(document).on('click', '.editar', function () {
                const id = $(this).data('id');
                $.get(`${API_URL}/${id}`, function (empleado) {
                    $('#nombre').val(empleado.nombre);
                    $('#puesto').val(empleado.puesto);
                    $('#salario').val(empleado.salario);
                    $('#fecha_contratacion').val(empleado.fecha_contratacion ? new Date(empleado.fecha_contratacion).toISOString().split('T')[0] : '');
                    $('#activo').val(empleado.activo ? 'true' : 'false');
                    $('#guardardatos').hide();
                    $('#actualizardatos').show().data('id', id);
                });
            });

            // Actualizar empleado
            $('#actualizardatos').click(function () {
                const id = $(this).data('id');
                const empleado = {
                    nombre: $('#nombre').val(),
                    puesto: $('#puesto').val(),
                    salario: parseFloat($('#salario').val()),
                    fecha_contratacion: $('#fecha_contratacion').val(),
                    activo: $('#activo').val() === 'true'
                };

                $.ajax({
                    url: `${API_URL}/${id}`,
                    type: 'PUT',
                    contentType: 'application/json',
                    data: JSON.stringify(empleado),
                    success: function () {
                        limpiarFormulario();
                        listarEmpleados();
                    },
                    error: function (err) {
                        alert('Error al actualizar empleado: ' + err.responseJSON.message);
                    }
                });
            });

            // Eliminar empleado
            $(document).on('click', '.eliminar', function () {
                if (!confirm('¿Estás seguro de eliminar este empleado?')) return;
                const id = $(this).data('id');

                $.ajax({
                    url: `${API_URL}/${id}`,
                    type: 'DELETE',
                    success: function () {
                        listarEmpleados();
                    },
                    error: function (err) {
                        alert('Error al eliminar empleado: ' + err.responseJSON.message);
                    }
                });
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
</body>

</html>